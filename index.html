<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="home-btn" onclick="showHomeView(); closeSidebar();" title="Home">&#127968;</button>
                <h2 class="sidebar-title">Decks</h2>
                <button class="sidebar-close" id="sidebar-close" onclick="toggleSidebar()">&#10005;</button>
            </div>
            <div class="sidebar-content" id="sidebar-content"></div>
            <div class="sidebar-actions">
                <button class="sidebar-create-btn" onclick="openModal('create-deck-modal')">+ Deck</button>
                <button class="sidebar-create-btn folder-create-btn" onclick="createNewFolder()">+ Folder</button>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <button class="menu-btn" id="menu-btn" onclick="toggleSidebar()">&#9776;</button>
                    <h1>Flashcard Study App</h1>
                    <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" title="Toggle theme">&#128161;</button>
                </div>
            </div>

            <!-- Home View -->
            <div id="home-view">
                <div class="home-welcome">
                    <h2>Your Decks</h2>
                    <p>Select a deck to start studying</p>
                </div>
                <div class="home-deck-grid" id="home-deck-grid"></div>
            </div>

            <!-- Study View (hidden by default) -->
            <div id="study-view" class="hidden">
                <div class="study-header">
                    <button class="back-home-btn" onclick="showHomeView()">&#8592; Back</button>
                    <span class="study-deck-name" id="study-deck-name"></span>
                </div>

                <div class="stats-bar" id="stats-bar">
                    <div class="stat">
                        <span class="stat-value" id="streak">0</span>
                        <span class="stat-label">Day Streak</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="deck-studied">0 / 0</span>
                        <span class="stat-label">Studied</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="accuracy">0%</span>
                        <span class="stat-label">Accuracy</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="best-streak">0</span>
                        <span class="stat-label">Best Streak</span>
                    </div>
                    <button class="stat-reset-btn" onclick="resetDeckStats()" title="Reset deck stats">&#8635;</button>
                </div>

                <div class="progress" id="progress-bar">
                    Card <span id="current-card">1</span> of <span id="total-cards">0</span>
                    <span id="review-label" class="review-label">â€” Reviewing Wrong Answers</span>
                </div>

                <div class="card-container" id="card-container">
                    <div class="card" id="flashcard" onclick="flipCard()">
                        <div class="card-front">
                            <p id="question">Select or create a deck to start!</p>
                        </div>
                        <div class="card-back">
                            <p id="answer">Answer will appear here</p>
                        </div>
                    </div>
                </div>

                <p class="flip-hint" id="flip-hint">Click card or press Space to flip</p>

                <!-- Learn Mode Panel -->
                <div id="learn-mode" class="learn-mode hidden">
                    <div class="learn-header">
                        <span class="learn-title">Learn Mode <span id="learn-round-info"></span></span>
                        <button class="learn-exit-btn" onclick="exitLearnMode()">Exit</button>
                    </div>
                    <div class="learn-progress-section">
                        <div class="learn-stats">
                            <span>Left: <strong id="learn-remaining">0</strong></span>
                            <span class="score-right">Correct: <strong id="learn-correct">0</strong></span>
                            <span class="score-wrong">Wrong: <strong id="learn-wrong">0</strong></span>
                        </div>
                        <div class="learn-progress-bar">
                            <div class="learn-bar-fill" id="learn-bar-fill"></div>
                        </div>
                    </div>
                    <div class="learn-question-card" id="learn-question-card">
                        <p id="learn-question"></p>
                    </div>
                    <div id="learn-mc" class="learn-mc hidden">
                        <div id="mc-options" class="mc-options"></div>
                    </div>
                    <div id="learn-type" class="learn-type hidden">
                        <div class="type-letter-hint" id="type-letter-hint"></div>
                        <div class="type-accept-note hidden" id="type-accept-note"></div>
                        <div class="type-input-row">
                            <input type="text" id="type-input" placeholder="Type your answer..." onkeydown="if(event.key==='Enter')submitTypedAnswer()" />
                        </div>
                        <div class="type-actions">
                            <button class="hint-btn" onclick="getHint()">Hint</button>
                            <button class="modal-confirm" onclick="submitTypedAnswer()">Submit</button>
                        </div>
                    </div>
                    <div id="learn-feedback" class="learn-feedback hidden">
                        <div id="feedback-result" class="feedback-result"></div>
                        <p class="feedback-correct-label" id="feedback-correct-label">Correct answer:</p>
                        <p id="feedback-answer" class="feedback-answer"></p>
                        <button class="modal-confirm learn-continue-btn" onclick="nextLearnCard()">Continue</button>
                    </div>
                    <div id="learn-results" class="learn-results hidden">
                        <h2>Round Complete!</h2>
                        <div class="results-stats">
                            <div class="result-stat">
                                <span class="result-value score-right" id="result-correct">0</span>
                                <span class="result-label">Correct</span>
                            </div>
                            <div class="result-stat">
                                <span class="result-value score-wrong" id="result-wrong">0</span>
                                <span class="result-label">Wrong</span>
                            </div>
                            <div class="result-stat">
                                <span class="result-value" id="result-accuracy">0%</span>
                                <span class="result-label">Accuracy</span>
                            </div>
                        </div>
                        <div class="results-actions">
                            <button class="modal-cancel" onclick="exitLearnMode()">Done</button>
                            <button class="modal-confirm" id="retry-wrong-btn" onclick="retryWrongCards()">Retry Wrong (<span id="retry-count">0</span>)</button>
                        </div>
                    </div>
                </div>

                <!-- Test Mode -->
                <div id="test-mode" class="test-mode hidden">
                    <!-- Config Screen -->
                    <div id="test-config" class="test-config">
                        <div class="learn-header">
                            <span class="learn-title">Test Setup</span>
                            <button class="learn-exit-btn" onclick="exitTestMode()">Cancel</button>
                        </div>
                        <p class="test-config-info">Choose how many of each question type. Total must be between 1 and <strong id="test-max-cards">0</strong>.</p>
                        <div class="test-config-rows">
                            <div class="test-config-row">
                                <label>Multiple Choice</label>
                                <div class="test-stepper">
                                    <button onclick="adjustTestCount('mc', -1)">-</button>
                                    <span id="test-mc-count">0</span>
                                    <button onclick="adjustTestCount('mc', 1)">+</button>
                                </div>
                            </div>
                            <div class="test-config-row">
                                <label>Matching</label>
                                <div class="test-stepper">
                                    <button onclick="adjustTestCount('match', -1)">-</button>
                                    <span id="test-match-count">0</span>
                                    <button onclick="adjustTestCount('match', 1)">+</button>
                                </div>
                            </div>
                            <div class="test-config-row">
                                <label>Writing</label>
                                <div class="test-stepper">
                                    <button onclick="adjustTestCount('write', -1)">-</button>
                                    <span id="test-write-count">0</span>
                                    <button onclick="adjustTestCount('write', 1)">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="test-config-total">
                            Total: <strong id="test-total-count">0</strong> / <strong id="test-total-max">0</strong>
                        </div>
                        <button class="modal-confirm test-start-btn" id="test-start-btn" onclick="startTest()" disabled>Start Test</button>
                    </div>

                    <!-- Active Test -->
                    <div id="test-active" class="hidden">
                        <div class="learn-header">
                            <span class="learn-title">Test <span id="test-progress-label"></span></span>
                            <button class="learn-exit-btn" onclick="exitTestMode()">Exit</button>
                        </div>
                        <div class="learn-progress-bar" style="margin-bottom:20px">
                            <div class="learn-bar-fill" id="test-bar-fill"></div>
                        </div>

                        <!-- MC Question -->
                        <div id="test-q-mc" class="hidden">
                            <div class="learn-question-card"><p id="test-mc-question"></p></div>
                            <div class="mc-options" id="test-mc-options"></div>
                        </div>

                        <!-- Matching Question -->
                        <div id="test-q-match" class="hidden">
                            <p class="test-match-instruction">Drag each term to its matching definition</p>
                            <div class="test-match-area">
                                <div class="test-match-terms" id="test-match-terms"></div>
                                <div class="test-match-defs" id="test-match-defs"></div>
                            </div>
                            <button class="modal-confirm test-submit-match" id="test-submit-match" onclick="submitMatching()">Submit Matching</button>
                        </div>

                        <!-- Writing Question -->
                        <div id="test-q-write" class="hidden">
                            <div class="learn-question-card"><p id="test-write-question"></p></div>
                            <div class="type-input-row">
                                <input type="text" id="test-write-input" placeholder="Type your answer..." onkeydown="if(event.key==='Enter')submitWritingAnswer()" />
                            </div>
                            <button class="modal-confirm" onclick="submitWritingAnswer()" style="margin-top:10px">Submit</button>
                        </div>

                        <!-- Per-question feedback -->
                        <div id="test-feedback" class="learn-feedback hidden">
                            <div id="test-feedback-result" class="feedback-result"></div>
                            <p class="feedback-correct-label" id="test-feedback-label">Correct answer:</p>
                            <p id="test-feedback-answer" class="feedback-answer"></p>
                            <button class="modal-confirm learn-continue-btn" onclick="nextTestQuestion()">Continue</button>
                        </div>
                    </div>

                    <!-- Test Results -->
                    <div id="test-results" class="learn-results hidden">
                        <h2>Test Complete!</h2>
                        <div class="results-stats">
                            <div class="result-stat">
                                <span class="result-value score-right" id="test-res-correct">0</span>
                                <span class="result-label">Correct</span>
                            </div>
                            <div class="result-stat">
                                <span class="result-value score-wrong" id="test-res-wrong">0</span>
                                <span class="result-label">Wrong</span>
                            </div>
                            <div class="result-stat">
                                <span class="result-value" id="test-res-accuracy">0%</span>
                                <span class="result-label">Accuracy</span>
                            </div>
                        </div>
                        <div class="test-results-breakdown" id="test-results-breakdown"></div>
                        <div class="results-actions">
                            <button class="modal-cancel" onclick="exitTestMode()">Done</button>
                            <button class="modal-confirm" onclick="openTestConfig()">New Test</button>
                        </div>
                    </div>
                </div>

                <div class="controls" id="controls">
                    <button class="nav-btn" onclick="prevCard()">Previous</button>
                    <button class="wrong-btn" onclick="markWrong()">Wrong</button>
                    <button class="right-btn" onclick="markRight()">Correct</button>
                    <button class="nav-btn" onclick="nextCard()">Next</button>
                </div>

                <div class="score" id="score">
                    <span class="score-right">Correct: <span id="right-count">0</span></span>
                    <span class="score-wrong">Wrong: <span id="wrong-count">0</span></span>
                </div>

                <div class="action-buttons" id="action-buttons">
                    <button class="shuffle-btn" onclick="shuffleDeck()">Shuffle</button>
                    <button class="learn-btn" onclick="startLearnMode()">Learn</button>
                    <button class="test-btn" onclick="openTestConfig()">Test</button>
                    <button class="review-btn" id="review-btn" onclick="toggleReviewMode()">Review Wrong (<span id="wrong-review-count">0</span>)</button>
                    <button class="manage-btn" onclick="openManageModal()">Manage Deck</button>
                </div>

                <div class="keyboard-hints">
                    <span>Space: Flip</span>
                    <span>Arrow Keys: Navigate</span>
                    <span>C: Correct</span>
                    <span>W: Wrong</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Deck Modal -->
    <div class="modal-overlay" id="create-deck-modal" onclick="closeModalOnOverlay(event, 'create-deck-modal')">
        <div class="modal">
            <h2>Create New Deck</h2>
            <input type="text" id="new-deck-name" placeholder="Deck name (e.g., Biology)" onkeydown="if(event.key==='Enter')createDeck()" />
            <div class="modal-buttons">
                <button class="modal-cancel" onclick="closeModal('create-deck-modal')">Cancel</button>
                <button class="modal-confirm" onclick="createDeck()">Create</button>
            </div>
        </div>
    </div>

    <!-- Manage Deck Modal -->
    <div class="modal-overlay" id="manage-modal" onclick="closeModalOnOverlay(event, 'manage-modal')">
        <div class="modal manage-modal">
            <h2>Manage: <span id="manage-deck-name"></span></h2>
            <div class="folder-assign">
                <label>Folder:</label>
                <select id="deck-folder-select" onchange="assignDeckFolder()">
                    <option value="">None</option>
                </select>
                <button class="folder-new-inline" onclick="createFolderFromManage()">+</button>
            </div>
            <div class="card-list" id="card-list"></div>
            <div class="import-section">
                <button class="import-toggle-btn" id="import-toggle-btn" onclick="toggleImport()">Paste / Import List</button>
                <div class="import-area hidden" id="import-area">
                    <textarea id="import-text" oninput="onImportInput()" placeholder="Paste your list here. Supports:&#10;&#10;term - definition&#10;term: definition&#10;term&#9;definition (tab-separated)&#10;term = definition&#10;&#10;One card per line." rows="6"></textarea>
                    <div class="import-actions">
                        <span class="import-hint" id="import-preview">0 cards detected</span>
                        <button class="modal-confirm" onclick="importCards()">Import All</button>
                    </div>
                </div>
            </div>
            <div class="add-card-form">
                <h3 id="card-form-title">Add New Card</h3>
                <textarea id="card-question" placeholder="Question / Front" rows="2"></textarea>
                <button class="ai-define-btn" id="ai-define-btn" onclick="aiDefine()">AI Define</button>
                <textarea id="card-answer" placeholder="Answer / Back" rows="2"></textarea>
                <input type="hidden" id="edit-card-index" value="-1" />
                <div class="card-form-buttons">
                    <button class="modal-cancel" id="cancel-edit-btn" onclick="cancelEdit()" style="display:none">Cancel Edit</button>
                    <button class="modal-confirm" onclick="saveCard()">Save Card</button>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-cancel delete-deck-btn" onclick="deleteDeck()">Delete Deck</button>
                <button class="modal-confirm" onclick="closeModal('manage-modal')">Done</button>
            </div>
        </div>
    </div>

    <!-- Folder Edit Modal -->
    <div class="modal-overlay" id="folder-edit-modal" onclick="closeModalOnOverlay(event, 'folder-edit-modal')">
        <div class="modal">
            <h2>Edit Folder</h2>
            <input type="text" id="folder-edit-name" placeholder="Folder name" />
            <div class="color-picker">
                <label>Color:</label>
                <div class="color-options" id="color-options"></div>
            </div>
            <div class="modal-buttons">
                <button class="modal-cancel" onclick="deleteFolder()">Delete Folder</button>
                <button class="modal-confirm" onclick="saveFolderEdit()">Save</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
